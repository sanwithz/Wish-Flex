<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNY 2026 Gift</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap');
        body { font-family: 'Kanit', sans-serif; text-align: center; background-color: #0d1b2a; color: white; margin: 0; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: #1b263b; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏π‡∏õ (Hidden) */
        #capture-area {
            position: relative;
            width: 300px;
            height: 360px; /* 1:1.2 Ratio */
            margin: auto;
            display: none; /* ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• */
        }
        #bg-img { width: 100%; height: 100%; object-fit: cover; }
        #profile-img {
            position: absolute;
            top: 20px; /* ‡∏ï‡∏≤‡∏° JSON ‡∏Ñ‡∏∏‡∏ì */
            right: 160px; /* ‡∏ï‡∏≤‡∏° JSON ‡∏Ñ‡∏∏‡∏ì (offsetEnd) */
            width: 85px;
            height: 85px;
            border-radius: 50%;
            object-fit: cover;
        }

        .preview-img { width: 100%; border-radius: 15px; margin-bottom: 20px; border: 2px solid #415a77; }
        .btn { padding: 15px; margin: 10px 0; border-radius: 15px; border: none; color: white; font-size: 16px; font-weight: 500; width: 100%; cursor: pointer; transition: 0.3s; }
        .btn-share { background-color: #06C755; }
        .btn-share:hover { background-color: #05a647; }
        .btn-download { background-color: #e0e1dd; color: #1b263b; }
        .btn-download:hover { background-color: #bdbeba; }
        #status { font-size: 14px; color: #778da9; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin-top:0;">Happy New Year 2026</h2>
    <p id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
    
    <div id="capture-area">
        <img id="bg-img" src="https://lh3.googleusercontent.com/d/1jduiSWXhb_P0wYl6s54LJOAp0Mfp82TU" crossorigin="anonymous">
        <img id="profile-img" src="" crossorigin="anonymous">
    </div>

    <div id="ui-ready" style="display:none;">
        <img id="user-preview" class="preview-img" src="">
        <button class="btn btn-share" onclick="sendShare()">üöÄ ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏∏‡πà‡∏°</button>
        <button class="btn btn-download" onclick="downloadImage()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        <p style="font-size: 12px; color: #778da9;">* ‡∏´‡∏≤‡∏Å‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ'</p>
    </div>
</div>

<script>
    const BG_PICTURE = "https://lh3.googleusercontent.com/d/1jduiSWXhb_P0wYl6s54LJOAp0Mfp82TU"; // URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
    const urlParams = new URLSearchParams(window.location.search);
    const userPic = urlParams.get('pic') || "https://www.w3schools.com/howto/img_avatar.png";

    async function main() {
        try {
            // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            await liff.init({ liffId: "2007125937-PPTr28Jp" }); 
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                renderPreview();
            }
        } catch (err) {
            document.getElementById('status').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î LIFF";
        }
    }

    function renderPreview() {
        document.getElementById('status').style.display = 'none';
        document.getElementById('ui-ready').style.display = 'block';
        document.getElementById('user-preview').src = userPic;
        document.getElementById('profile-img').src = userPic;
    }

    function sendShare() {
        if (!liff.isApiAvailable('shareTargetPicker')) {
            alert("‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ");
            return;
        }
        liff.shareTargetPicker([
            {
                "type": "flex",
                "altText": "Happy New Year 2026 üéÅ",
                "contents": {
                    "type": "bubble",
                    "size": "giga",
                    "body": {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                            {
                                "type": "image",
                                "url": BG_PICTURE,
                                "size": "full",
                                "aspectMode": "cover",
                                "aspectRatio": "1:1.2",
                                "gravity": "center"
                            },
                            {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                    {
                                        "type": "image",
                                        "url": userPic,
                                        "size": "full",
                                        "aspectMode": "cover"
                                    }
                                ],
                                "position": "absolute",
                                "offsetTop": "20px",
                                "offsetEnd": "160px",
                                "width": "85px",
                                "height": "85px",
                                "cornerRadius": "100px"
                            }
                        ],
                        "paddingAll": "0px"
                    }
                }
            }
        ]).then(res => {
            if (res) liff.closeWindow();
        }).catch(err => console.error(err));
    }

    function downloadImage() {
        const area = document.getElementById('capture-area');
        area.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå

        html2canvas(area, { 
            useCORS: true,
            allowTaint: true,
            scale: 2 // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î
        }).then(canvas => {
            const base64image = canvas.toDataURL("image/png");
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ Preview ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡∏ü‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢
            document.getElementById('user-preview').src = base64image;
            
            // ‡∏™‡∏±‡πà‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
            const link = document.createElement('a');
            link.download = 'HNY2026.png';
            link.href = base64image;
            link.click();
            
            area.style.display = 'none';
            alert("‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏´‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÄ‡∏ã‡∏ü‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
        });
    }

    main();
</script>
</body>
</html>
